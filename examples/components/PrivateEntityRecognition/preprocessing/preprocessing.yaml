
$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
name: preprocessing_in_silo
version: 0.1.0
display_name: Pre-Processing (in silo)
type: command
description: Component for preprocessing raw data in a given silo. The images are transformed using random affine keeping the center invariant, then normalized.
is_deterministic: true

inputs:
  metrics_prefix:
    type: string
    description: Metrics prefix
    default: Default-prefix
    optional: true
  total_num_of_silos:
    type: integer
    description: Number of silos
    default: 3
    optional: true
  silo_num:
    type: integer
    description: Silo number (0-indexed)
    default: 0
    optional: true

  iteration_num:
    type: integer
    description: Iteration number
    default: 1
    optional: true
outputs:
  processed_train_data:
    type: uri_folder
    description: the output training data after preprocessing
  processed_test_data:
    type: uri_folder
    description: the output testing data after preprocessing

code: .

command: >-
  python run.py --train_output ${{outputs.processed_train_data}} --test_output ${{outputs.processed_test_data}} $[[--total_num_of_silos ${{inputs.total_num_of_silos}}]] $[[--silo_num ${{inputs.silo_num}}]] $[[--metrics_prefix ${{inputs.metrics_prefix}}]]

environment: 
  conda_file: ./conda.yaml
  image: mcr.microsoft.com/azureml/openmpi3.1.2-ubuntu18.04
